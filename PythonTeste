import time
from playwright.sync_api import sync_playwright
from time import sleep

    # login
def login(page):
    page.goto("http://localhost:8080/home/Inicio")
    page.get_by_placeholder("Usuário@Conexão").click()
    page.get_by_placeholder("Usuário@Conexão").fill("administrador@apuracaoTributosAM")
    page.get_by_placeholder("Senha").click()
    page.get_by_placeholder("Senha").fill("masterkey")
    page.get_by_role("button", name="o PERMITIR").click()
    page.get_by_role("button", name="o ENTRAR").click()

    #Acessa fiscal e seleção de empresa e periodo
def AcessaFiscal(page):
    page.get_by_role("link", name="Fiscal").click()
    page.locator("#btnCODIGOEMPRESA").click()
    page.get_by_role("gridcell", name="8700").click()
    time.sleep(3)
    page.get_by_role("button", name="o SELECIONAR", exact=True).click()
    page.locator("#btnCODIGOESTAB").click()
    page.get_by_label("Page 2").click()
    page.get_by_role("gridcell", name="14", exact=True).click()
    page.get_by_role("button", name="o SELECIONAR", exact=True).click()
    page.get_by_role("textbox", name="Informe a data inicial para o filtro do período fiscal").click()
    page.get_by_role("textbox", name="Informe a data final para o filtro do período fiscal").click()
    page.get_by_role("button", name="o Selecionar").click()

    #Acessa menu Obrigações / Simples nacional / Area de trabalho Simples Nacional
def AcessaFiscalObrigacoesSimplesAreadeTrabalho(page):
    page.get_by_role("button", name="Obrigações").click()
    page.get_by_role("link", name="Simples Nacional").click()
    page.goto("http://localhost:8080/npmnFis/Processo?Scope={Class:%22TnFisDPAreaTrabalhoSimplesNacional%22,pathName:%22OBRIGACOES_SIMPLESNACIONAL%22}")
    time.sleep(3)
    page.get_by_role("heading", name="Configurações do Simples Nacional").click()

    #Cadastro de Exigibilidade fiscal
def AcessaFiscalCadastroExigibilidadeFiscal(page):
    page.locator("a").filter(has_text="Configuração Exigibilidade Suspensa").click()
    page.get_by_label("Novo Registro").click()
    page.frame_locator("#framemodal").locator("#btnCODIGOEMPRESA").click()
    page.frame_locator("#framemodal").get_by_role("gridcell", name="8700").click()
    time.sleep(1)
    page.frame_locator("#framemodal").get_by_role("button", name="o SELECIONAR").click()
    time.sleep(1)
    page.frame_locator("#framemodal").locator("#btnCODIGOOPERACAOFIS").click()
    page.frame_locator("#framemodal").locator(".dx-scrollable-content > .dx-datagrid-content > .dx-datagrid-table > tbody > tr > td").first.click()
    page.frame_locator("#framemodal").get_by_role("button", name="o SELECIONAR").click()
    page.frame_locator("#framemodal").get_by_role("textbox", name="Data Inicial").click()
    page.frame_locator("#framemodal").get_by_role("textbox", name="Data Inicial").fill("01/09/2023")
    page.frame_locator("#framemodal").get_by_role("textbox", name="Data Inicial").press("Tab")
    page.frame_locator("#framemodal").get_by_role("textbox", name="Data Final").fill("30/09/2023")
    page.frame_locator("#framemodal").get_by_role("textbox", name="Data Final").press("Tab")
    time.sleep(1)
    page.frame_locator("#framemodal").get_by_label("Imposto  *").select_option("1")
    page.frame_locator("#framemodal").get_by_label("Nº Processo  *").fill("12560")
    page.frame_locator("#framemodal").get_by_label("Motivo Suspensão  *").select_option("3")
    page.frame_locator("#framemodal").get_by_label("Vara  *").click()
    page.frame_locator("#framemodal").get_by_label("Vara  *").fill("Tes1")
    time.sleep(1)
    page.frame_locator("#framemodal").locator("#btnSIGLAESTADO").click()
    page.frame_locator("#framemodal").get_by_role("gridcell", name="AM", exact=True).click()
    page.frame_locator("#framemodal").get_by_role("button", name="o SELECIONAR").click()
    page.frame_locator("#framemodal").locator("#btnCODIGOMUNIC").click()
    page.frame_locator("#framemodal").locator("tr:nth-child(6) > td").first.click()
    page.frame_locator("#framemodal").get_by_role("button", name="o SELECIONAR").click()
    page.frame_locator("#framemodal").get_by_label("Com Depósito  *").select_option("0")
    page.frame_locator("#framemodal").get_by_role("button", name="o  SALVAR").click()
    time.sleep(1)
    page.get_by_role("button", name="o Sair").click()
    page.get_by_role("link", name="").click()
    page.frame_locator("#framemodal").get_by_label("Imposto  *").select_option("3")
    page.frame_locator("#framemodal").get_by_label("Nº Processo  *").click()
    page.frame_locator("#framemodal").get_by_label("Nº Processo  *").fill("1256P")
    page.frame_locator("#framemodal").get_by_label("Vara  *").click()
    page.frame_locator("#framemodal").get_by_label("Vara  *").fill("TeRR")
    page.frame_locator("#framemodal").get_by_role("button", name="o  SALVAR").click()
    page.get_by_role("button", name="o Sair").click()
    page.get_by_role("link", name="").click()
    page.get_by_label("Sim").click()
    page.get_by_role("button", name="Retornar à página inicial da área de trabalho").click()


def main():
    playwright = sync_playwright().start()
    browser = playwright.chromium.launch(headless=False)
    # login
    page = browser.new_page()
    login(page)

    # Acessa fiscal e seleção de empresa e periodo
    AcessaFiscal(page)

    # Acessa menu Obrigações / Simples nacional / Area de trabalho Simples Nacional
    AcessaFiscalObrigacoesSimplesAreadeTrabalho(page)

    # Cadastro de Exigibilidade fiscal
    AcessaFiscalCadastroExigibilidadeFiscal(page)

    #page.pause()  # sempre usar para gravar

    print(page.title())


main()
